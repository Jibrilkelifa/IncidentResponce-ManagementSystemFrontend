<form #incidentForm="ngForm" (ngSubmit)="onSubmit(incidentForm)" class="bg-gray-800 p-6 rounded-lg shadow-md">
  <div class="flex flex-col gap-6 text-gray-200">
    
    <!-- Row 1: Category & Subcategory -->
    <div class="flex gap-4">
      <div class="w-1/2">
        <label for="category" class="block mb-2 font-semibold">Category:</label>
        <select
          id="category"
          name="category"
          [(ngModel)]="incident.category"
          (change)="onCategoryChange()"
          required
          class="dark-input"
        >
          <option value="" disabled>Select Category</option>
          <option *ngFor="let cat of getCategories()" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <div class="w-1/2" *ngIf="showSubcategory">
        <label for="subcategory" class="block mb-2 font-semibold">Subcategory:</label>
       <select
          id="subcategory"
          name="subcategory"
          [(ngModel)]="incident.subcategory"
          (change)="onSubcategoryChange()"
           required
          class="dark-input"
        >
          <option value="" disabled>Select Subcategory</option>
          <option *ngFor="let sub of getSubcategories()" [value]="sub">{{ sub }}</option>
        </select>

      </div>
      
    </div>
    <div class="mt-2" *ngIf="showCustomSubcategory">
  <label for="customSubcategory" class="block mb-2 font-semibold">Specify Subcategory:</label>
  <input
    type="text"
    id="customSubcategory"
    name="customSubcategory"
    [(ngModel)]="customSubcategory"
    required
    placeholder="Enter custom subcategory"
    class="dark-input"
  />
</div>


    <!-- Row 2: Assigned To & Description -->
    <div class="flex gap-4">
      <div class="w-1/2">
        <label for="assignee" class="block mb-2 font-semibold">Assigned To:</label>
        <input
          type="text"
          id="assignee"
          name="assignee"
          [(ngModel)]="incident.assignee"
          required
          readonly
          pInputText
          class="dark-input"
        />
      </div>

      <div class="w-1/2">
        <label for="description" class="block mb-2 font-semibold">Description:</label>
        <textarea
          id="description"
          name="description"
          [(ngModel)]="incident.description"
          required
          rows="4"
          pInputTextarea
          class="dark-input resize-vertical"
        ></textarea>
      </div>
    </div>

    <!-- Row 3: Sources & Affected Assets -->
    <div class="flex gap-4">
      <div class="w-1/2">
        <label for="sources" class="block mb-2 font-semibold">Sources:</label>
        <div class="flex gap-4">
          <input
            type="text"
            id="sources"
            [(ngModel)]="newSource"
            name="newSource"
            placeholder="Add a source IP"
            class="dark-input w-full"
          />
          <button
            type="button"
            (click)="addSource()"
            class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:ring-2 focus:ring-blue-500"
          >
            Add
          </button>
        </div>
        <ul class="mt-2 list-disc pl-6 text-gray-300">
          <li *ngFor="let source of incident.sources; let i = index" class="flex items-center gap-2">
            <span>{{ source }}</span>
            <button type="button" (click)="removeSource(i)" class="text-red-500 hover:underline">Remove</button>
          </li>
        </ul>
      </div>

      <div class="w-1/2">
        <label for="affectedAssets" class="block mb-2 font-semibold">Affected Assets:</label>
        <div class="flex gap-4">
          <input
            type="text"
            id="affectedAssets"
            [(ngModel)]="newAsset"
            name="newAsset"
            placeholder="Add an affected asset"
            class="dark-input w-full"
          />
          <button
            type="button"
            (click)="addAsset()"
            class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:ring-2 focus:ring-blue-500"
          >
            Add
          </button>
        </div>
        <ul class="mt-2 list-disc pl-6 text-gray-300">
          <li *ngFor="let asset of incident.affectedSystems; let i = index" class="flex items-center gap-2">
            <span>{{ asset }}</span>
            <button type="button" (click)="removeAsset(i)" class="text-red-500 hover:underline">Remove</button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Row 4: Severity & Recommended Action -->
    <div class="flex gap-4">
      <div class="w-1/2">
        <label for="severity" class="block mb-2 font-semibold">Severity:</label>
        <select
          id="severity"
          name="severity"
          [(ngModel)]="incident.severity"
          required
          class="dark-input"
        >
          <option value="" disabled>Select Severity</option>
          <option *ngFor="let severity of severityOptions" [value]="severity.value">{{ severity.label }}</option>
        </select>
      </div>

      <div class="w-1/2">
        <label for="recommendedAction" class="block mb-2 font-semibold">Recommended Action:</label>
        <textarea
          id="recommendedAction"
          name="recommendedAction"
          [(ngModel)]="incident.recommendedAction"
          required
          rows="4"
          pInputTextarea
          class="dark-input resize-vertical"
        ></textarea>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end mt-4">
      <button
        type="submit"
        [disabled]="incidentForm.invalid || loading"
        class="px-6 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 focus:ring-2 focus:ring-green-500 disabled:opacity-50"
      >
        {{ incident.id ? 'Update Incident' : 'Create Incident' }}
      </button>
    </div>
  </div>
</form>
